version: '3'

networks:
  default:
    ipam:
      driver: default
      config:
        - subnet: ${LGS_HOST_SUBNET}/24
services:
  mongo:
    restart: always
    image: mongo:4
    ports:
      - 27018:27018
    volumes:
      - /data/storage/team-builder.mongodb:/data/db
    environment:
      - MONGO_INITDB_ROOT_USERNAME=${MONGO_INITDB_ROOT_USERNAME}
      - MONGO_INITDB_ROOT_PASSWORD=${MONGO_INITDB_ROOT_PASSWORD}
    command: mongod --port 27018
    env_file:
      - .env
  app:
    image: ${LGS_DOCKER_IMAGE}
    restart: always
    working_dir: /usr/src/app/server
    ports:
      - 5001:5001
    volumes:
      - /data/logs/team-builder:/usr/src/app/server/logs
      - /data/logs/team-builder/npm:/root/.npm/
    depends_on:
      - mongo
    env_file:
      - .env
    environment:
      WAIT_HOSTS: mongo:27018
    command: pm2-runtime ecosystem.config.js --env production
